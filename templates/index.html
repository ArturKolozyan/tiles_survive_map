{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiles Survive - Battle Map</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>‚öîÔ∏è Battle Map</h1>
                <div class="mode-switch">
                    <button id="devMode" class="mode-btn active">üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞</button>
                    <button id="gameMode" class="mode-btn">üéÆ –ò–≥—Ä–∞</button>
                </div>
            </div>

            <div class="sidebar-content">
                <!-- Developer Panel -->
                <div id="devPanel" class="panel">
                    <div class="section">
                        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ–π</h3>
                        <button id="newMapBtn" class="btn btn-primary">üÜï –ù–æ–≤–∞—è –∫–∞—Ä—Ç–∞</button>
                        <button id="loadMapBtn" class="btn btn-secondary">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                        <button id="saveMapBtn" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>

                    <div class="section">
                        <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É</h3>
                        <button class="btn btn-add" onclick="addPoint('alliance_start')">‚≠ê –¢–æ—á–∫–∞ –Ω–∞—á–∞–ª–∞</button>
                        <button class="btn btn-add" onclick="addPoint('tower', 'XS', 80)">üîµ –í—ã—à–∫–∞ XS (80)</button>
                        <button class="btn btn-add" onclick="addPoint('tower', 'S', 240)">üîµ –í—ã—à–∫–∞ S (240)</button>
                        <button class="btn btn-add" onclick="addPoint('tower', 'M', 320)">üîµ –í—ã—à–∫–∞ M (320)</button>
                        <button class="btn btn-add" onclick="addPoint('tower', 'L', 480)">üîµ –í—ã—à–∫–∞ L (480)</button>
                        <button class="btn btn-add" onclick="addPoint('tower', 'XL', 800)">üîµ –í—ã—à–∫–∞ XL (800)</button>
                        <button class="btn btn-add" onclick="addPoint('tower', 'XXL', 1600)">üîµ –í—ã—à–∫–∞ XXL (1600)</button>
                        <button class="btn btn-add" onclick="addPoint('lair', 'XS', 80)">üü¶ –õ–æ–≥–æ–≤–æ XS (80)</button>
                        <button class="btn btn-add" onclick="addPoint('lair', 'S', 160)">üü¶ –õ–æ–≥–æ–≤–æ S (160)</button>
                        <button class="btn btn-add" onclick="addPoint('lair', 'M', 300)">üü¶ –õ–æ–≥–æ–≤–æ M (300)</button>
                    </div>

                    <div class="section">
                        <h3>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h3>
                        <button id="connectBtn" class="btn btn-tool">üîó –°–æ–µ–¥–∏–Ω–∏—Ç—å</button>
                        <button id="disconnectBtn" class="btn btn-tool">‚úÇÔ∏è –†–∞–∑—ä–µ–¥–∏–Ω–∏—Ç—å</button>
                        <button id="cancelBtn" class="btn btn-danger" style="display:none;">‚ùå –û—Ç–º–µ–Ω–∞</button>
                    </div>

                    <div class="section">
                        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ä—Ç—ã</h3>
                        <label>–°–≤–æ—è —Ç–æ—á–∫–∞ –Ω–∞—á–∞–ª–∞:</label>
                        <select id="myAllianceSelect">
                            <option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–∞</option>
                        </select>
                        
                        <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–Ω–∏):</label>
                        <input type="number" id="durationInput" value="10" min="1" max="60">
                        
                        <label>–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞ (00:00 UTC):</label>
                        <input type="date" id="startDateInput">
                        
                        <button id="startMapBtn" class="btn btn-success">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                        <button id="stopMapBtn" class="btn btn-danger" style="display:none;">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    </div>

                    <div id="pointEditPanel" class="section" style="display:none;">
                        <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–∫—É</h3>
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                        <input type="text" id="pointNameInput" readonly>
                        
                        <label>–ù–µ—Ñ—Ç—å –≤ –¥–µ–Ω—å:</label>
                        <input type="number" id="pointOilInput" min="0">
                        
                        <label>–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è (–¥–µ–Ω—å):</label>
                        <input type="number" id="pointUnlockInput" min="0">
                        
                        <label>–†–∞–∑–º–µ—Ä:</label>
                        <select id="pointSizeInput">
                            <option value="XS">XS</option>
                            <option value="S">S</option>
                            <option value="M">M</option>
                            <option value="L">L</option>
                            <option value="XL">XL</option>
                            <option value="XXL">XXL</option>
                        </select>
                        
                        <button id="deletePointBtn" class="btn btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>

                <!-- Game Panel -->
                <div id="gamePanel" class="panel" style="display:none;">
                    <div class="section">
                        <h3>üé® –õ–µ–≥–µ–Ω–¥–∞</h3>
                        <div class="legend">
                            <div class="legend-item">
                                <span class="legend-color" style="background: #ddd;"></span>
                                <span>–ë–µ–ª—ã–µ (—Å–≤–æ–±–æ–¥–Ω—ã–µ)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color" style="background: #4CAF50;"></span>
                                <span>–ó–µ–ª–µ–Ω—ã–µ (–∑–∞—Ö–≤–∞—á–µ–Ω—ã)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color" style="background: #2196F3;"></span>
                                <span>–°–∏–Ω–∏–µ (–≥—Ä–∞–Ω–∏—Ü–∞/–±–æ–π)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color" style="background: #f44336;"></span>
                                <span>–ö—Ä–∞—Å–Ω—ã–µ (—Ç–æ—á–∫–∏ –Ω–∞—á–∞–ª–∞ –≤—Ä–∞–≥–∞)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color" style="background: #666;"></span>
                                <span>–°–µ—Ä—ã–µ (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏)</span>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>‚è±Ô∏è –¢–∞–π–º–µ—Ä</h3>
                        <div id="gameTimer" class="timer">–ö–∞—Ä—Ç–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞</div>
                        <div id="currentDay" class="day-info"></div>
                    </div>

                    <div class="section">
                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div class="stat-row">
                            <span>–í—Å–µ–≥–æ –Ω–µ—Ñ—Ç–∏:</span>
                            <span id="totalOil">0</span>
                        </div>
                        <div class="stat-row">
                            <span>–ù–µ—Ñ—Ç—å/–¥–µ–Ω—å:</span>
                            <span id="dailyOil">0</span>
                        </div>
                        <div class="stat-row">
                            <span>–ë–µ–ª—ã–µ —Ç–æ—á–∫–∏:</span>
                            <span id="whiteCount">0</span>
                        </div>
                        <div class="stat-row">
                            <span>–ó–µ–ª–µ–Ω—ã–µ —Ç–æ—á–∫–∏:</span>
                            <span id="capturedCount">0</span>
                        </div>
                        <div class="stat-row">
                            <span>–°–∏–Ω–∏–µ —Ç–æ—á–∫–∏:</span>
                            <span id="battleCount">0</span>
                        </div>
                        <div class="stat-row">
                            <span>–ö—Ä–∞—Å–Ω—ã–µ —Ç–æ—á–∫–∏:</span>
                            <span id="enemyCount">0</span>
                        </div>
                    </div>

                    <div id="pointGamePanel" class="section" style="display:none;">
                        <h3>–¢–æ—á–∫–∞: <span id="gamePointName"></span></h3>
                        
                        <label>–¶–≤–µ—Ç:</label>
                        <select id="pointColorGame">
                            <option value="white">‚ö™ –ë–µ–ª–∞—è</option>
                            <option value="green">üü¢ –ó–µ–ª–µ–Ω–∞—è</option>
                            <option value="blue">üîµ –°–∏–Ω—è—è</option>
                        </select>
                        
                        <label>–ú–µ—Ç–∫–∞:</label>
                        <select id="pointMarkerGame">
                            <option value="">–ë–µ–∑ –º–µ—Ç–∫–∏</option>
                            <option value="‚öîÔ∏è">‚öîÔ∏è –ê—Ç–∞–∫–æ–≤–∞—Ç—å</option>
                            <option value="üõë">üõë –ù–µ –∞—Ç–∞–∫–æ–≤–∞—Ç—å</option>
                            <option value="üëÅÔ∏è">üëÅÔ∏è –ù–∞–±–ª—é–¥–∞—Ç—å</option>
                            <option value="üéØ">üéØ –ó–∞—Ö–≤–∞—Ç –æ—Å—Ç–∞—Ç–∫–∞–º–∏</option>
                            <option value="üéñÔ∏è">üéñÔ∏è –ù–∞–±–∏—Ç—å—Å—è –≤ —Ü–µ–Ω—Ç—Ä</option>
                            <option value="üêã">üêã –û—Ö–æ—Ç–∞ –Ω–∞ –∫–∏—Ç–∞</option>
                            <option value="‚ö°">‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</option>
                            <option value="üî•">üî• –ì–æ—Ä—è—á–∞—è —Ç–æ—á–∫–∞</option>
                            <option value="‚ùå">‚ùå –ò–∑–±–µ–≥–∞—Ç—å</option>
                        </select>
                        
                        <button id="applyGameChanges" class="btn btn-success">‚úì –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                    </div>

                    <div class="section">
                        <button id="expandBtn" class="btn btn-primary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Map Canvas -->
        <div class="map-area">
            <canvas id="mapCanvas"></canvas>
            <div id="notification" class="notification"></div>
        </div>
    </div>

    <!-- Save Modal -->
    <div id="saveModal" class="modal">
        <div class="modal-content">
            <h3>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Ä—Ç—É</h3>
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
            <input type="text" id="mapNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ...">
            <div class="modal-buttons">
                <button id="confirmSave" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="cancelSave" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Load Modal -->
    <div id="loadModal" class="modal">
        <div class="modal-content">
            <h3>üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É</h3>
            <div id="mapList" class="map-list"></div>
            <button id="cancelLoad" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- Battle Resolution Modal -->
    <div id="battleModal" class="modal">
        <div class="modal-content">
            <h3>‚öîÔ∏è –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –±–æ–µ–≤</h3>
            <p style="margin-bottom: 15px; color: #aaa;">–û—Ç–º–µ—Ç—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–æ–µ–≤ –∑–∞ —Å–∏–Ω–∏–µ —Ç–æ—á–∫–∏:</p>
            <div id="battleList" class="battle-list"></div>
            <div class="modal-buttons">
                <button id="confirmBattles" class="btn btn-success">‚úì –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                <button id="cancelBattles" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script src="{% static 'js/app.js' %}"></script>
</body>
</html>
