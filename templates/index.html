{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiles Survive - Map Editor</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <div class="container">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>üó∫Ô∏è Map Editor</h1>
                
                <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ -->
                <div class="mode-switch">
                    <button id="developerMode" class="mode-btn active">üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</button>
                    <button id="gameMode" class="mode-btn">üéÆ –ò–≥—Ä–∞</button>
                    <button id="statsMode" class="mode-btn">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                </div>
            </div>

            <div class="sidebar-content">
                <!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
                <div id="statsPanel" class="panel" style="display: none;">
                    <div class="section">
                        <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—Ä—Ç—ã</h4>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="totalOilAccumulated">0</div>
                                <div class="stat-label">–í—Å–µ–≥–æ –Ω–µ—Ñ—Ç–∏</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="dailyOilIncome">0</div>
                                <div class="stat-label">–ù–µ—Ñ—Ç—å/–¥–µ–Ω—å</div>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="capturedTowers">0</div>
                                <div class="stat-label">–í—ã—à–∫–∏</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="capturedLairs">0</div>
                                <div class="stat-label">–õ–æ–≥–æ–≤–∞</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalCaptured">0</div>
                                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—Ö–≤–∞—á–µ–Ω–æ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="battlePoints">0</div>
                                <div class="stat-label">–ò–¥–µ—Ç –±–æ–π</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –ü–∞–Ω–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ -->
                <div id="developerPanel" class="panel">
                    <div class="section">
                        <h4>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h4>
                        <button id="addPointBtn" class="btn btn-primary">‚ûï –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ç–æ—á–∫–∞</button>
                        <button id="connectPointsBtn" class="btn btn-secondary">üîó –°–æ–µ–¥–∏–Ω–∏—Ç—å —Ç–æ—á–∫–∏</button>
                        <button id="disconnectPointsBtn" class="btn btn-secondary">‚úÇÔ∏è –û—Ç—Å–æ–µ–¥–∏–Ω–∏—Ç—å —Ç–æ—á–∫–∏</button>
                        <button id="cancelConnectionBtn" class="btn btn-danger" style="display: none;">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å</button>
                    </div>
                    
                    <div class="section">
                        <h4>–ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ</h4>
                        <p style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">üîµ –ö—Ä—É–≥ = –í—ã—à–∫–∞ | üü¶ –ö–≤–∞–¥—Ä–∞—Ç = –õ–æ–≥–æ–≤–æ</p>
                        <button class="btn btn-primary" onclick="addPresetPoint('alliance_start', 'medium', '–¢–æ—á–∫–∞ –Ω–∞—á–∞–ª–∞', 0, 'START')">‚≠ê –¢–æ—á–∫–∞ –Ω–∞—á–∞–ª–∞</button>
                        <button class="btn btn-secondary" onclick="addPresetPoint('lair', 'medium', '–õ–æ–≥–æ–≤–æ XS', 80, 'XS')">üü¶ –õ–æ–≥–æ–≤–æ XS (80)</button>
                        <button class="btn btn-secondary" onclick="addPresetPoint('lair', 'medium', '–õ–æ–≥–æ–≤–æ S', 160, 'S')">üü¶ –õ–æ–≥–æ–≤–æ S (160)</button>
                        <button class="btn btn-secondary" onclick="addPresetPoint('lair', 'medium', '–õ–æ–≥–æ–≤–æ M', 300, 'M')">üü¶ –õ–æ–≥–æ–≤–æ M (300)</button>
                        <button class="btn btn-secondary" onclick="addPresetPoint('tower', 'medium', '–í—ã—à–∫–∞ S', 240, 'S')">üîµ –í—ã—à–∫–∞ S (240)</button>
                        <button class="btn btn-secondary" onclick="addPresetPoint('tower', 'medium', '–í—ã—à–∫–∞ M', 320, 'M')">üîµ –í—ã—à–∫–∞ M (320)</button>
                        <button class="btn btn-secondary" onclick="addPresetPoint('tower', 'medium', '–í—ã—à–∫–∞ L', 480, 'L')">üîµ –í—ã—à–∫–∞ L (480)</button>
                        <button class="btn btn-secondary" onclick="addPresetPoint('tower', 'medium', '–í—ã—à–∫–∞ XL', 800, 'XL')">üîµ –í—ã—à–∫–∞ XL (800)</button>
                        <button class="btn btn-secondary" onclick="addPresetPoint('tower', 'medium', '–í—ã—à–∫–∞ XXL', 1600, 'XXL')">üîµ –í—ã—à–∫–∞ XXL (1600)</button>
                    </div>
                    
                    <div class="section">
                        <h4>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ–π</h4>
                        <button id="saveMapBtn" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                        <button id="loadMapBtn" class="btn btn-primary">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                        <button id="newMapBtn" class="btn btn-secondary">üÜï –ù–æ–≤–∞—è –∫–∞—Ä—Ç–∞</button>
                    </div>
                    
                    <div class="section">
                        <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ä—Ç—ã</h4>
                        <label>–°–≤–æ—è —Ç–æ—á–∫–∞ –Ω–∞—á–∞–ª–∞</label>
                        <select id="myAllianceStart">
                            <option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–∞</option>
                        </select>
                        
                        <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–Ω–∏)</label>
                        <input type="number" id="mapDuration" value="10" min="1" max="60">
                        
                        <label>–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞ (00:00 UTC)</label>
                        <input type="date" id="mapStartDate">
                        
                        <button id="startMapBtn" class="btn btn-success">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                        <button id="stopMapBtn" class="btn btn-danger" style="display: none;">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                    </div>

                    <div class="section" id="pointSettings" style="display: none;">
                        <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ—á–∫–∏</h4>
                        
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏</label>
                        <input type="text" id="pointName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
                        
                        <label>–¢–∏–ø —Ç–æ—á–∫–∏</label>
                        <select id="pointType">
                            <option value="tower">üîµ –í—ã—à–∫–∞ (–∫—Ä—É–≥)</option>
                            <option value="lair">üü¶ –õ–æ–≥–æ–≤–æ (–∫–≤–∞–¥—Ä–∞—Ç)</option>
                            <option value="alliance_start">‚≠ê –¢–æ—á–∫–∞ –Ω–∞—á–∞–ª–∞</option>
                        </select>
                        
                        <div id="oilAmountGroup">
                            <label>–ù–µ—Ñ—Ç—å –≤ –¥–µ–Ω—å</label>
                            <input type="number" id="oilAmount" value="60" min="0">
                        </div>
                        
                        <div id="unlockDayGroup">
                            <label>–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ (–¥–Ω–µ–π)</label>
                            <input type="number" id="unlockDay" value="0" min="0">
                        </div>
                        
                        <div id="pointStatusGroup">
                            <label>–°—Ç–∞—Ç—É—Å</label>
                            <select id="pointStatus">
                                <option value="free">‚ö™ –°–≤–æ–±–æ–¥–Ω–æ</option>
                                <option value="captured">üü¢ –ó–∞—Ö–≤–∞—á–µ–Ω–æ</option>
                                <option value="battle">üî¥ –ò–¥–µ—Ç –±–æ–π</option>
                            </select>
                        </div>
                        
                        <div id="pointSizeGroup">
                            <label>–†–∞–∑–º–µ—Ä —Ç–æ—á–∫–∏</label>
                            <select id="pointSize">
                                <option value="xs">XS (45px)</option>
                                <option value="small">S (60px)</option>
                                <option value="medium" selected>M (75px)</option>
                                <option value="large">L (105px)</option>
                                <option value="xl">XL (135px)</option>
                                <option value="xxl">XXL (165px)</option>
                            </select>
                        </div>
                        
                        <button id="deletePoint" class="btn btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç–æ—á–∫—É</button>
                    </div>
                </div>

                <!-- –ü–∞–Ω–µ–ª—å –∏–≥—Ä—ã -->
                <div id="gamePanel" class="panel" style="display: none;">
                    <div class="section">
                        <h4 id="gameTimerTitle">‚è±Ô∏è –¢–∞–π–º–µ—Ä –∫–∞—Ä—Ç—ã</h4>
                        <div id="gameTimer" style="font-size: 24px; text-align: center; color: #4CAF50; margin: 10px 0;">
                            –ö–∞—Ä—Ç–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞
                        </div>
                    </div>
                    
                    <div class="section" id="pointSettingsGame" style="display: none;">
                        <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ—á–∫–∏</h4>
                        
                        <label>–°—Ç–∞—Ç—É—Å</label>
                        <select id="pointStatusGame">
                            <option value="free">‚ö™ –°–≤–æ–±–æ–¥–Ω–æ</option>
                            <option value="captured">üü¢ –ó–∞—Ö–≤–∞—á–µ–Ω–æ</option>
                            <option value="battle">üî¥ –ò–¥–µ—Ç –±–æ–π</option>
                        </select>
                        
                        <label>–ú–µ—Ç–∫–∞</label>
                        <select id="pointMarkerGame">
                            <option value="none">üö´ –ë–µ–∑ –º–µ—Ç–∫–∏</option>
                            <option value="attack">‚öîÔ∏è –ê—Ç–∞–∫–æ–≤–∞—Ç—å</option>
                            <option value="noattack">üõë –ù–µ –∞—Ç–∞–∫–æ–≤–∞—Ç—å</option>
                            <option value="observe">üëÅÔ∏è –ù–∞–±–ª—é–¥–∞–µ–º</option>
                            <option value="capture">üéØ –ó–∞—Ö–≤–∞—Ç –æ—Å—Ç–∞—Ç–∫–∞–º–∏</option>
                            <option value="center">üéñÔ∏è –ù–∞–±–∏—Ç—å—Å—è –≤ —Ü–µ–Ω—Ç—Ä</option>
                            <option value="whale">üêã –û—Ö–æ—Ç–∞ –Ω–∞ –∫–∏—Ç–∞</option>
                        </select>
                    </div>
                    
                    <div class="section">
                        <button id="clearMarkersGame" class="btn btn-danger">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –º–µ—Ç–∫–∏</button>
                    </div>

                    <div class="section">
                        <h4>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç–æ–∫</h4>
                        <div id="markerCountGame" class="stat-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å –∫–∞—Ä—Ç—ã -->
        <div class="map-area">
            <div class="map-controls">
                <button id="zoomIn" class="control-btn">+</button>
                <button id="zoomOut" class="control-btn">‚àí</button>
                <button id="resetView" class="control-btn">‚ü≤</button>
            </div>
            <div id="notification" class="notification"></div>
            <canvas id="mapCanvas"></canvas>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
    <div id="saveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Ä—Ç—É</h3>
                <button class="modal-close" onclick="closeSaveModal()">√ó</button>
            </div>
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã</label>
            <input type="text" id="mapName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ...">
            <button class="btn btn-success" onclick="saveMap()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É</h3>
                <button class="modal-close" onclick="closeLoadModal()">√ó</button>
            </div>
            <div id="mapList" class="map-list"></div>
        </div>
    </div>

    <script src="{% static 'js/state.js' %}"></script>
    <script src="{% static 'js/api.js' %}"></script>
    <script src="{% static 'js/canvas.js' %}"></script>
    <script src="{% static 'js/ui.js' %}"></script>
    <script src="{% static 'js/main.js' %}"></script>
</body>
</html>
